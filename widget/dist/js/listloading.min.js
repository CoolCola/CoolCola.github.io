!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Listloading=e()}(this,function(){"use strict";function t(t){var e=Date.parse(new Date),l=(e-t)/1e3,i=parseInt(l/86400),n=parseInt(l/3600),o=parseInt(l/60),s=parseInt(l);if(i>0&&i<4)return i+"天前";if(i<=0&&n>0)return n+"小时前";if(n<=0&&o>0)return o+"分钟前";if(o<=0&&s>=0)return"刚刚之前";var r=new Date(t);return r.getFullYear()+"年"+(r.getMonth()+1)+"月"+r.getDate()+"日 "+r.getHours()+"::"+r.getMinutes()+":"+r.getSeconds()}function e(t,e){this.ele=$(t);var l=this.ele.attr("id");return l||(l="listLoading"+Math.random().toString().replace("0.",""),this.ele.attr("id",l)),this.id=l,this.children=$(this.ele.get(0).children[0]),"object"==typeof e&&$.isFunction(e.pullDownAction)?(this.pullUpId="pullUp-"+l,this.pullDownId="pullDown-"+l,void this.init(e)):void(this.iscroll=new IScroll("#"+l,e.iscrollOptions))}var l=function(){var t,e,l,i,n,o;return e={},o=this,t=function(t,l){var i,n;return i=null!=(n=e[t])?n:e[t]=[],i.push(l)},l=function(e,l){return i(e),t(e,l)},i=function(t){var l;return null!=(l=e[t])?l.length=0:void 0},n=function(){var t,l,i,n,s,r;for(r=Array.prototype.shift.call(arguments),l=null!=(s=e[r])?s:e[r]=[],i=0,n=l.length;i<n;i++){if(t=l[i],void 0==t)return!1;if(t.apply(o,arguments)===!1)return!1}},{listen:t,one:l,remove:i,trigger:n}}();return e.prototype={version:"1.1.6",init:function(t){this.options={},this.options.upLoadmoretxt='<i class="icon-up"></i>上拉加载更多',this.options.pullDrefreshtxt='<i class="icon-down"></i>下拉加载更多',this.options.loadertxt='<i class="icon-loading"></i>正在加载更多',this.options.Realtimetxt="松开刷新",this.options.loaderendtxt="已显示完全部",this.options.viewHeight=this.ele.height(),this.options.pullUpActionStr="pullUpActionStr"+this.id,this.options.pullDownActionStr="pullDownAction"+this.id,l.remove(this.options.pullUpActionStr),l.remove(this.options.pullDownActionStr),$.extend(this.options,t),this.render()},render:function(){this.pullDownAction(!0)},destroy:function(){this.children.css({"-webkit-transform":"",transform:""}),$("#"+this.pullDownId+", #"+this.pullUpId).remove(),this.iscroll.destroy()},refresh:function(t){this.createPullUpEle(t)},createPullUpEle:function(t){var e=this.options,l=this.children;l.css("min-height","auto");var i=l.height(),n=this.pullUpId,o=e.viewHeight,s=e.pullDownOffset,r=this.iscroll;if(e.minScrollHeight=o+s,this.pullUpEle)i<e.minScrollHeight&&(this.pullUpEle.remove(),this.pullUpEle=null,this.options.pullUpOffset=0,l.css("min-height",e.minScrollHeight));else if($.isFunction(e.pullUpAction)&&i>e.minScrollHeight){var a='<div id="'+n+'" data-class="pullUpId"><span class="pullUpLabel inlineblock-span">'+e.upLoadmoretxt+"</span></div>";l.append(a),this.pullUpEle=$("#"+n),e.pullUpOffset=this.pullUpEle.get(0).offsetHeight}else l.css("min-height",e.minScrollHeight);r&&(this.pullUpEle&&!t&&this.pullUpEle.height(0),r.refresh(),this.pullUpEle&&!t&&(this.pullUpEle.removeAttr("style"),r.maxScrollY=r.maxScrollY-this.options.pullUpOffset),0!==r.y||t||this.resizeAnimate())},createPullIScroll:function(){var e=this.options,l="";e.disableTime&&(e.endDate=Date.parse(new Date),l='<span class="time">最后更新时间：<em id="'+this.id+'time-em">'+t(e.endDate)+"</em></span>");var i=$('<div id="'+this.pullDownId+'" data-class="pullDownId">    <span class="pullDownLabel inlineblock-span">'+e.pullDrefreshtxt+"</span>"+l+"</div>");i.prependTo(this.children),this.pullDownEle=i,this.options.pullDownOffset=i.get(0)?i.get(0).offsetHeight:0,this.createPullUpEle()},toggleClassText:function(t,e,l,i){t.attr("class",e).find("."+l).html(i)},resizeAnimate:function(t){var e=this.iscroll,l=this.options.pullDownOffset;if(t){var i=-e.maxScrollY-l;-t<=i&&(t=-i)}else t=-l;e.scrollTo(0,t,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var e=this,l=this.options,i=this.iscroll,n=(this.pullUpId,this.pullDownEle),o=this.toggleClassText,s=l.pullDrefreshtxt,r=l.upLoadmoretxt,a=l.Realtimetxt,u=l.loadertxt,p=-l.pullDownOffset;this.ele.get(0).addEventListener("touchstart",function(t){t.returnValue=!0}),i.on("scrollStart",function(){var i=e.pullUpEle;e.startPullTime=(new Date).getTime(),l.disableTime&&$("#"+e.id+"time-em").html(t(l.endDate)),n&&n.hasClass("loading")?o(n,"","pullDownLabel",s):i&&i.hasClass("loading")&&o(i,"","pullUpLabel",r)}),i.on("scrollMove",function(){var t=this.y,l=this.maxScrollY,i=e.pullUpEle,u=5,p=n.hasClass("flip"),c=i&&i.hasClass("flip");t>u&&!p?o(n,"flip","pullDownLabel",'<i class="icon-up"></i>'+a):t<u&&p?o(n,"","pullDownLabel",s):i&&t<l-u&&!c?o(i,"flip","pullUpLabel",'<i class="icon-down"></i>'+a):i&&t>l+u&&c&&o(i,"","pullUpLabel",r)}),i.on("scrollEnd",function(){var t=this.y,i=this.maxScrollY,s=e.pullUpEle,r=new Date;return t===i&&s&&o(s,"flip","pullUpLabel",a),e.endPullTime=r.getTime(),e.totalGapTime=e.endPullTime-e.startPullTime,e.options.endDate=Date.parse(r),e.totalGapTime<200?void(t>p&&t<1&&e.resizeAnimate()):void(n&&n.hasClass("flip")?(o(n,"loading","pullDownLabel",u),e.pullDownAction()):s&&s.hasClass("flip")?(o(s,"loading","pullUpLabel",u),e.pullUpAction()):t>p&&t<1?e.resizeAnimate():-i>=-t&&i+l.pullUpOffset>t&&e.resizeAnimate(i+l.pullUpOffset))})},pullDownAction:function(t){var e=(new Date).getTime()-this.startPullTime,i=this,n=this.options,o=n.pullDownAction,s=n.pullDownActionStr;$("#"+i.id);$.isFunction(o)&&(this.iscroll||(l.listen(s,function(){i.createPullIScroll();var t={startY:-n.pullDownOffset,listLoading:!0,scrollbars:!0};$.extend(t,n.iscrollOptions),i.iscroll=new IScroll("#"+i.id,t),i.scrollEvent(),l.remove(s)}),o(function(){l.trigger(s)},t)),e>=400&&(l.listen(s,function(){i.refresh(!0);var t=i.pullUpEle;t?t.find(".pullUpLabel").html(n.upLoadmoretxt):i.createPullUpEle(),setTimeout(function(){$("body").removeClass("iscroll"),i.resizeAnimate(),i.iscroll.refresh(),l.remove(s)},1e3)}),o(function(){$("body").addClass("iscroll"),l.trigger(s)},t)))},pullUpAction:function(){var t=this,e=(new Date).getTime()-t.startPullTime,i=t.options,n=i.pullUpAction,o=i.pullUpActionStr,s=t.iscroll;if($.isFunction(n)){var r=s.y+i.pullUpOffset;e>=400?(l.listen(o,function(){t.refresh(!0);var e=t.pullUpEle,n=i.loaderendtxt;i.pullEnd?setTimeout(function(){$("body").removeClass("iscroll"),t.resizeAnimate(r)},1e3):($("body").removeClass("iscroll"),n=i.upLoadmoretxt,s.refresh()),e.find(".pullUpLabel").html(n),l.remove(o)}),n(function(t){$("body").addClass("iscroll"),i.pullEnd=t,l.trigger(o)})):t.resizeAnimate(r)}},evt:function(t,e,l,i){var n="ontouchstart"in window,o=n?"touchstart":"mousedown",s=n?"touchend":"mouseup",r=n?"touchmove":"mousemove",a=n?"touchleave":"mouseout",u=function(t){var e={},l=t.originalEvent;return void 0==l&&(l=t),l.changedTouches?(e.pageX=l.changedTouches[0].pageX,e.pageY=l.changedTouches[0].pageY,e.clientX=l.changedTouches[0].clientX,e.clientY=l.changedTouches[0].clientY):(e.pageX=t.pageX,e.pageY=t.pageY,e.clientX=t.clientX,e.clientY=t.clientY),e.evt=t,e},p=function(t){return{x:t.clientX,y:t.clientY}},c=function(t,e){return t&&e?Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)):0},h=function(t,e,l){var i=u(e);l(t,i)},f=function(t,e,l){var i=u(e);l(t,i)},d=function(t,e,l){var i=u(e);l(t,i)},m=function(t,e,l){var i=u(e);l(t,i)},v=this.ele;switch(void 0==i&&(i=!0),e){case"mousemove":case"touchmove":i&&v.off(r,t),v.on(r,t,function(t){m($(this),t,l)});break;case"click":case"tap":var g,w=20,U=function(t){var e=u(t);g=p(e)},D=function(t,e,i){var n=u(e),o=(Date.now(),p(n)),s=c(g,o);s<w&&h(t,e,l)};i&&(v.off(o,t),v.off(s,t)),v.on(o,t,function(t){2!=t.button&&U(t)}),v.on(s,t,function(t){if(2!=t.button){var e=$(this);D(e,t,l)}});break;case"mousedown":case"touchstart":i&&v.off(o,t),v.on(o,t,function(t){f($(this),t,l)});break;case"mouseup":case"touchend":i&&v.off(s,t),v.on(s,t,function(t){d($(this),t,l)});break;case"mouseout":i&&v.off(a,t),v.on(a,t,function(t){D(t,l)})}}},e});